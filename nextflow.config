// nextflow.config
manifest {
    name = 'CAP'
    author = 'Piotr Włodzimierz'
    homePage = 'https://github.com/vlothec/CAP'
    description = 'Centromere Analysis Pipeline with TRASH2'
    mainScript = 'main.nf'
    nextflowVersion = '!>=24.10.0'
    version = '1.0'
}

env {
    WORKFLOW_DIR = "${baseDir}"
}

params {
    assembly = null
    templates = null
    te_gff = null
    gene_gff = null
    cores = 1
    max_rep_size = 1000
    min_rep_size = 7
    outdir = "./results"
}

process {
    cpus = params.cores
    memory = '4 GB'
    errorStrategy = 'terminate'
    //errorStrategy = 'retry'
    //maxRetries = 1
}

profiles {
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        process.container = 'yourname/cap-pipeline:latest'
    }
    conda {
        conda.enabled = true
        conda.useMamba = true
        process.conda = "${projectDir}/environment.yml"
    }
    renv {
        process.executor = 'local'
        process.shell = ['/bin/bash', '-euo', 'pipefail']
        // Source renv environment before every Rscript call
        process.beforeScript = """
            if [ -f "${projectDir}/renv/activate.R" ]; then
                echo "Activating R renv environment..."
                export R_PROFILE_USER="${projectDir}/renv/activate.R"
            else
                echo "Warning: renv environment not found — please run 'R -e \\"renv::restore()\\"' first."
            fi
        """
        env.R_LIBS_USER = "${projectDir}/renv/library"
    }
}
